#https://leetcode.com/problems/numbers-with-repeated-digits/description/

class Solution:
    def numDupDigitsAtMostN(self, n: int) -> int:
        s = str(n)
        m = len(s)

        def perm(a, b):
            res = 1
            for i in range(b):
                res *= (a - i)
            return res

        # 1. Count numbers with unique digits and length < m
        unique = 0
        for length in range(1, m):
            unique += 9 * perm(9, length - 1)

        # 2. Count numbers with unique digits and length == m
        used = set()
        for i, ch in enumerate(s):
            digit = int(ch)
            for d in range(0 if i else 1, digit):
                if d not in used:
                    unique += perm(10 - (i + 1), m - i - 1)
            if digit in used:
                break
            used.add(digit)
        else:
            # n itself has unique digits
            unique += 1

        return n - unique
